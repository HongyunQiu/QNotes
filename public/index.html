<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QNotes 云协作笔记</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- 使用官方EditorJS文件和验证成功的插件 -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest/dist/bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest/dist/bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@latest/dist/bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@latest/dist/bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/editorjs-mermaid@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/attaches@latest"></script>
    <script src="vendor/editorjs-codemirror/bundle.js"></script>
    <script>
      // 检查EditorJS是否加载成功
      window.addEventListener('load', () => {
        console.log('页面加载完成');
        console.log('EditorJS:', typeof window.EditorJS);
        console.log('Header:', typeof window.Header);
        console.log('Paragraph:', typeof window.Paragraph);
        console.log('Checklist:', typeof window.Checklist);
        console.log('Quote:', typeof window.Quote);
        console.log('Delimiter:', typeof window.Delimiter);
        console.log('ImageTool:', typeof window.ImageTool);
        console.log('MermaidTool:', typeof window.MermaidTool);
        console.log('CodeMirror:', typeof window.CodeMirror);
        
        // 检查所有必需的插件
        const requiredPlugins = ['EditorJS', 'Header', 'Paragraph', 'Checklist', 'Quote', 'Delimiter', 'ImageTool', 'MermaidTool', 'CodeMirror'];
        const missingPlugins = [];
        
        if (typeof window.EditorJS === 'undefined') missingPlugins.push('EditorJS');
        if (typeof window.Header === 'undefined') missingPlugins.push('Header');
        if (typeof window.Paragraph === 'undefined') missingPlugins.push('Paragraph');
        if (typeof window.Checklist === 'undefined') missingPlugins.push('Checklist');
        if (typeof window.Quote === 'undefined') missingPlugins.push('Quote');
        if (typeof window.Delimiter === 'undefined') missingPlugins.push('Delimiter');
        if (typeof window.ImageTool === 'undefined') missingPlugins.push('ImageTool');
        
        if (typeof window.MermaidTool === 'undefined') missingPlugins.push('MermaidTool');
        if (typeof window.CodeMirror === 'undefined') missingPlugins.push('CodeMirror');
        
        if (missingPlugins.length > 0) {
          console.error('以下插件加载失败:', missingPlugins);
          alert('编辑器插件加载失败: ' + missingPlugins.join(', ') + '，请检查网络连接');
        } else {
          console.log('所有插件加载成功');
        }
      });
    </script>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">QNotes</div>
      <div class="spacer"></div>
      <div class="user-info">
        <span id="current-user"></span>
        <button id="logout-btn">退出</button>
      </div>
    </header>

    <main class="app">
      <aside class="sidebar">
        <div class="sidebar-header">
          <button id="sidebar-mode-toggle" class="tab toggle-notes" title="切换视图">我的笔记</button>
          <button id="new-note-btn" title="新建笔记">＋</button>
        </div>
        <ul id="note-tree" class="note-tree"></ul>
      </aside>
      <div id="resizer" class="resizer"></div>
      <section class="editor-panel">
        <div class="editor-header">
          <input id="note-title" placeholder="无标题笔记" />
          <div class="editor-actions">
            <div class="save-status" title="保存状态">
              <span id="save-indicator" class="save-indicator status-ok"></span>
              <span id="save-status-text" class="save-status-text">已就绪</span>
            </div>
            <label class="autosave-toggle" title="开启/关闭每60秒自动保存">
              <input type="checkbox" id="autosave-toggle" />
              <span>自动保存</span>
            </label>
            <button id="save-btn" disabled>保存</button>
            <button id="clear-btn">清空</button>
            <button id="delete-btn" class="danger" disabled>删除</button>
          </div>
        </div>
        <div id="lock-info" class="lock-info hidden"></div>
        <div id="editorjs" class="editor-container"></div>
        <div id="keywords-bar" class="keywords-bar">
          <div id="keywords-list" class="keywords-list"></div>
          <input id="keywords-input" class="keywords-input" placeholder="添加关键词，回车确认" />
        </div>
      </section>
    </main>

    <script src="app.js"></script>
  </body>
</html>
