## 关键词（keyword）功能说明

### 背景与目标
为每篇笔记增加关键词（一个或多个词语）功能。关键词不在编辑器内容内部保存，而是在编辑区域下方以紧凑条展示，支持增删，尽量占用很小的垂直空间，避免影响编辑区大小。

### 数据库与后端
- **表结构**：在 `notes` 表新增 `keywords` 列，类型为 `TEXT`，以 JSON 字符串形式存储字符串数组，默认值 `'[]'`。
- **兼容迁移**：启动时检测 `notes` 是否已有 `keywords` 列；若不存在则执行 `ALTER TABLE` 增加该列（参见 `src/db.js`）。

#### API 变更
- **GET** `/api/notes/:id`
  - 返回字段新增：`keywords: string[]`（从 `notes.keywords` 解析得到，解析失败则为空数组）。

- **POST** `/api/notes`
  - 新建笔记时 `keywords` 初始化为 `[]`（空数组）。

- **PUT** `/api/notes/:id`
  - 新增请求体字段：`keywords: string[]`。
  - 服务端会对 `keywords` 做基本清洗：仅保留字符串、两端去空白、去空字符串；最终以 JSON 字符串保存。

示例（请求体）：
```json
{
  "title": "示例标题",
  "content": { "blocks": [] },
  "keywords": ["计划", "周报", "OKR"]
}
```

### 前端实现
- **UI 结构**（位于编辑器下方）：
  - `#keywords-bar`：关键词条容器（紧凑、单行高度）。
  - `#keywords-list`：当前关键词以“胶囊”形式展示，可点击 × 删除。
  - `#keywords-input`：输入框，按回车添加；支持用逗号一次添加多个。

- **交互与行为**：
  - 回车添加：将输入内容按逗号拆分、去重、去空后加入。
  - 退格删除：当输入框为空时按退格会删除最后一个关键词。
  - 点击删除：点击关键词胶囊上的 × 按钮可删除该关键词。
  - 与保存联动：关键词变化会标记为“有未保存更改”，手动保存/自动保存时会一并提交。

- **状态与同步**：
  - 在 `public/app.js` 中新增 `currentKeywords` 维护当前笔记的关键词。
  - 加载笔记（`loadNote`）时填充 `currentKeywords` 并渲染关键词条。
  - 保存笔记（`persistNote`）时在 `PUT /api/notes/:id` 的请求体中包含 `keywords`。

### 使用指南
- 在编辑区下方的输入框中输入关键词并按回车即可添加；支持用逗号分隔一次添加多个。
- 点击关键词右侧的 × 按钮可删除；输入框为空时按退格也会删除最后一个关键词。
- 手动保存或开启自动保存时，关键词会与内容一起保存到服务器。

### 已知限制与后续建议
- 目前未提供基于关键词的搜索/过滤功能；如需可在左侧树或新增筛选栏中扩展。
- 树形列表中暂不展示关键词徽标；如需可在 `note-tree` 处追加样式与渲染。

### 关键改动文件
- `src/db.js`：新增 `keywords` 列，启动时执行兼容迁移。
- `src/server.js`：
  - `GET /api/notes/:id` 返回 `keywords`。
  - `POST /api/notes` 初始化 `keywords: []`。
  - `PUT /api/notes/:id` 接收并保存 `keywords`。
- `public/index.html`：在编辑器下方新增 `#keywords-bar`、`#keywords-list`、`#keywords-input`。
- `public/styles.css`：新增关键词条与胶囊的紧凑样式，保证条目高度较小。
- `public/app.js`：
  - 新增 `currentKeywords` 与渲染/增删逻辑。
  - `loadNote` 加载关键词；`persistNote` 一并保存关键词。


